<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Transaction Ops - chaosmatrix</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta itemprop="name" content="Transaction Ops">
<meta itemprop="description" content="Rules Every Operation must has RollBack Operation All ops done success or no ops done Transaction Ops Rule Stages Backup Stage backup current system state GoTo Next if Success Exit if it fails PreTest Stage in order to generate test rule make sure system working before apply operation GoTo Next if Success Exit if it fails Operate Stage do the operation that we want to do GoTo Next if Success GoTo RollBack Stage if it fails PostTest Stage apply custom-built test rule apply test rule generate in PreTest Stage GoTo RollBack Stage if it fails RollBack Stage only exec while Failed PostTest Stage apply Backup Stage to rollback system Use Transaction Ops Framework Example Update Network Route #!"><meta itemprop="datePublished" content="2019-12-17T20:05:18+08:00" />
<meta itemprop="dateModified" content="2019-12-17T20:05:18+08:00" />
<meta itemprop="wordCount" content="213">
<meta itemprop="keywords" content="" /><meta property="og:title" content="Transaction Ops" />
<meta property="og:description" content="Rules Every Operation must has RollBack Operation All ops done success or no ops done Transaction Ops Rule Stages Backup Stage backup current system state GoTo Next if Success Exit if it fails PreTest Stage in order to generate test rule make sure system working before apply operation GoTo Next if Success Exit if it fails Operate Stage do the operation that we want to do GoTo Next if Success GoTo RollBack Stage if it fails PostTest Stage apply custom-built test rule apply test rule generate in PreTest Stage GoTo RollBack Stage if it fails RollBack Stage only exec while Failed PostTest Stage apply Backup Stage to rollback system Use Transaction Ops Framework Example Update Network Route #!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://chaosmatrix.github.io/blog/transaction-ops/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2019-12-17T20:05:18+08:00" />
<meta property="article:modified_time" content="2019-12-17T20:05:18+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Transaction Ops"/>
<meta name="twitter:description" content="Rules Every Operation must has RollBack Operation All ops done success or no ops done Transaction Ops Rule Stages Backup Stage backup current system state GoTo Next if Success Exit if it fails PreTest Stage in order to generate test rule make sure system working before apply operation GoTo Next if Success Exit if it fails Operate Stage do the operation that we want to do GoTo Next if Success GoTo RollBack Stage if it fails PostTest Stage apply custom-built test rule apply test rule generate in PreTest Stage GoTo RollBack Stage if it fails RollBack Stage only exec while Failed PostTest Stage apply Backup Stage to rollback system Use Transaction Ops Framework Example Update Network Route #!"/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="https://chaosmatrix.github.io/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://chaosmatrix.github.io/css/main.css" />

        <link id="dark-scheme" rel="stylesheet" type="text/css" href="https://chaosmatrix.github.io/css/dark.css" />

	<script src="https://chaosmatrix.github.io/js/feather.min.js"></script>
	
		<script src="https://chaosmatrix.github.io/js/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
		<div class="avatar">
			<a href="https://chaosmatrix.github.io/">
				<img src="https://avatars.githubusercontent.com/u/37551759?v=4" alt="chaosmatrix" />
			</a>
		</div>
	
	<h1 class="site-title"><a href="https://chaosmatrix.github.io/">chaosmatrix</a></h1>
	<div class="site-description"><p>chaosmatrix, thoughts come and go, words stay eternal</p><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/chaosmatrix" title="Github"><i data-feather="github"></i></a></li><li><a href="#" class="scheme-toggle" id="scheme-toggle"></a></li></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/blog">Blog</a>
			</li>
			
			<li>
				<a href="/wasm">Wasm</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">17</span>
							<span class="rest">Dec 2019</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">Transaction Ops</h1>
				</div>
			</div>
					
			<div class="markdown">
				<h2 id="rules">Rules</h2>
<ol>
<li>Every Operation must has <strong>RollBack Operation</strong></li>
<li>All ops done success or no ops done</li>
</ol>
<h2 id="transaction-ops-rule">Transaction Ops Rule</h2>
<ol>
<li>Stages
<ol>
<li>Backup Stage
<ul>
<li>backup current system state</li>
<li>GoTo Next if Success</li>
<li>Exit if it fails</li>
</ul>
</li>
<li>PreTest Stage
<ul>
<li>in order to generate test rule</li>
<li>make sure system working before apply operation</li>
<li>GoTo Next if Success</li>
<li>Exit if it fails</li>
</ul>
</li>
<li>Operate Stage
<ul>
<li>do the operation that we want to do</li>
<li>GoTo Next if Success</li>
<li>GoTo <strong>RollBack Stage</strong> if it fails</li>
</ul>
</li>
<li>PostTest Stage
<ul>
<li>apply custom-built test rule</li>
<li>apply test rule generate in <strong>PreTest Stage</strong></li>
<li>GoTo <strong>RollBack Stage</strong> if it fails</li>
</ul>
</li>
<li>RollBack Stage
<ul>
<li>only exec while Failed <strong>PostTest Stage</strong></li>
<li>apply <strong>Backup Stage</strong> to rollback system</li>
</ul>
</li>
</ol>
</li>
<li>Use Transaction Ops Framework</li>
</ol>
<h2 id="example">Example</h2>
<ol>
<li>Update Network Route</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#008000">#!/bin/bash</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>set -u
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#008000"># notify</span>
</span></span><span style="display:flex;"><span>notify(){
</span></span><span style="display:flex;"><span>    <span style="color:#008000"># do notify</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#008000"># 1. backup network route</span>
</span></span><span style="display:flex;"><span>backup_route(){
</span></span><span style="display:flex;"><span>    <span style="color:#008000"># do something</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#008000"># 2. generate test-case</span>
</span></span><span style="display:flex;"><span>generate_testcase(){
</span></span><span style="display:flex;"><span>    <span style="color:#008000"># do something</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000"># nameserver in /etc/hosts</span>
</span></span><span style="display:flex;"><span>    <span style="color:#008000"># other connection via &#34;contrack&#34; or &#34;ss&#34; command</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#008000"># 3. update network route</span>
</span></span><span style="display:flex;"><span>update_route(){
</span></span><span style="display:flex;"><span>    <span style="color:#008000"># do something</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#008000"># 4. apply test-case</span>
</span></span><span style="display:flex;"><span>apply_testcase(){
</span></span><span style="display:flex;"><span>    <span style="color:#008000"># do something</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#008000"># 5. rollback network route</span>
</span></span><span style="display:flex;"><span>rollback_route(){
</span></span><span style="display:flex;"><span>    <span style="color:#008000"># do something</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#008000"># main</span>
</span></span><span style="display:flex;"><span>main(){
</span></span><span style="display:flex;"><span>    backup_route <span style="color:#a31515">\
</span></span></span><span style="display:flex;"><span><span style="color:#a31515"></span>        &amp;&amp; generate_testcase <span style="color:#a31515">\
</span></span></span><span style="display:flex;"><span><span style="color:#a31515"></span>        &amp;&amp; update_route <span style="color:#a31515">\
</span></span></span><span style="display:flex;"><span><span style="color:#a31515"></span>        &amp;&amp; (apply_testcase || rollback_route)
</span></span><span style="display:flex;"><span>    <span style="color:#00f">if</span> [ $? -ne 0 ]
</span></span><span style="display:flex;"><span>    <span style="color:#00f">then</span>
</span></span><span style="display:flex;"><span>        notify
</span></span><span style="display:flex;"><span>    <span style="color:#00f">fi</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>main
</span></span></code></pre></div>
			</div>

			<div class="tags">
				
					
				
			</div></div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div>2022  © Copyright chaosmatrix |  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>

<script>feather.replace()</script>
</body>
</html>
